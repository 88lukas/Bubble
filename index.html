<!DOCTYPE html>
<html lang="de">
	<head>
		<meta charset="utf-8" />
		<title>KompassAndroid2</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
		<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    		<script type="text/javascript" charset="utf-8">
			var zb = null;
			var img = null;
			var winkelalt = 0;

			// Wait for device API libraries to load			  
			    document.addEventListener("deviceready", onDeviceReady, false);

			    // device APIs are available
			    //
			    function onDeviceReady() {
				startWatch();
			    }

				function startWatch() {

					img = new Image();
				img.src = 'images/kompass.png';
				zb = document.getElementById("rose").getContext('2d');
				zb.translate(125, 125);
				document.addEventListener("deviceready", function() {
					navigator.compass.watchHeading(success, error, {
						frequency : 1000
					});
				}, false);
				    }			
			function success(heading) {
				var winkel = Math.floor(heading.magneticHeading);
				document.getElementById('kompass').innerHTML = winkel;
				zb.translate(-125, -125);
				zb.clearRect(0, 0, 500, 500);
				zb.translate(125, 125);
				zb.rotate((winkelalt - winkel) * Math.PI / 180);
				winkelalt = winkel;
				zb.drawImage(img, -125, -125);
			}

			function error(compassError) {
				document.getElementById('kompass').innerHTML = ('Fehler: ' + compassError.code);

			}		
		</script>
	</head>
	<body>
		<h1 class="ausrichtung rundeEcken">Himmelsrichtung</h1>
		<div id="kompass" class="schriftspeed hintergrund vordergrundspeed rundeEcken ausrichtung">
			###
		</div>
		<div class="ausrichtung2">
			<canvas id="rose" width="250" height="250"></canvas>
		</div>

	</body>
</html>

